map $uri $temporary_redirect_uri {
	~^/unicorns/?$ /about;
	~^/people/?$ /about;
}

map $uri $permanent_redirect_uri {
	~^/authors/crutchcorn/?$ /people/crutchcorn;
	~^/posts/?$ /;
	~^/unicorns/(?<name>[\w-]+)/?$ /people/$name;
	~^/posts/what-is-use-form-state-and-status/?$ /posts/what-is-use-action-state-and-form-status;
	~^/page/[0-9]+/?$ /search;
}

server {
    listen 80;
	access_log off;
    root /usr/share/nginx/html;
    index index.html;
    etag on;

	# HTTP compression
	gzip on;
	gzip_vary on;
	gzip_proxied any;
	gzip_comp_level 6;
	gzip_buffers 16 8k;
	gzip_http_version 1.1;
	gzip_min_length 256;

	error_page 404 /404.html;
	try_files $uri/index.html $uri/ $uri =404;
	absolute_redirect off;

	add_header Cache-Control "public, max-age=0, must-revalidate";
	add_header Cross-Origin-Embedder-Policy "require-corp";
	add_header Cross-Origin-Opener-Policy "same-origin";

    location * {}

	# Cache Astro computed assets for 1d
    location /_astro/ {
        add_header Cache-Control "public, max-age=86400, immutable";
    }

    # Cache large or static assets for 1yr
    location ~* \.(png|jpg|jpeg|gif|mp4|ttf|woff|woff2)$ {
        add_header Cache-Control "public, max-age=31536000, immutable";
    }

	# Redirects
	if ($temporary_redirect_uri) {
		return 302 $temporary_redirect_uri;
	}
	if ($permanent_redirect_uri) {
		return 301 $permanent_redirect_uri;
	}
}
